<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>Admin</title>
<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:#2c7be5;color:#fff;padding:12px}
button{padding:6px;margin:4px}
.card{background:#fff;padding:8px;margin:6px;border-radius:6px}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px}
.card.out {
  background: #e0e0e0;
  color: #888;
  cursor: not-allowed;
}
.card.out b {
  text-decoration: line-through;
}
@media print {
  @page {
    size: 58mm auto;
    margin: 0;
  }

  body {
    margin: 0;
    padding: 0;
  }

  body * {
    visibility: hidden;
  }

  .print-area, .print-area * {
    visibility: visible;
  }

  .print-area {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    font-family: Arial, Tahoma, sans-serif;
    font-size: 12px;
    line-height: 1.4;
  }

  .print-area h3 {
    text-align: center;
    margin: 4px 0;
    font-size: 14px;
  }

  .print-area hr {
    border: none;
    border-top: 1px dashed #000;
    margin: 6px 0;
  }
}

</style>
</head>
<body>

<header><h2>Saikhan POS ‚Äì ADMIN</h2></header>

<h3>‚ûï Menu –Ω—ç–º—ç—Ö</h3>
<input id="n" placeholder="–ù—ç—Ä">
<input id="p" type="number" placeholder="“Æ–Ω—ç">
<select id="c">
<option>–•–æ–æ–ª</option>
<option>–£—Å</option>
<option>–£–Ω–¥–∞–∞</option>
<option>–¶–∞–π</option>
</select>
<input id="q" type="number" placeholder="–¢–æ–æ (—É—Å/—Ü–∞–π)">
<button onclick="add()">–ù—ç–º—ç—Ö</button>

<h3>‚úèÔ∏è –ó–∞—Å–≤–∞—Ä</h3>
<div id="list"></div>

<h3>üìä –ù—ç–≥—Ç–≥—ç–ª (realtime)</h3>
<table>
<thead><tr><th>–ù—ç—Ä</th><th>–¢–æ–æ</th><th>–ù–∏–π—Ç</th></tr></thead>
<tbody id="settle"></tbody>
</table>
  
  <script>
if(localStorage.getItem("role")!=="admin"){
  location.href="login.html";
}

async function add(){
  await fetch("/api/menu",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      name:n.value,
      price:+p.value,
      cat:c.value,
      qty:+q.value||0
    })
  });
  load();
}

async function load(){
  const m = await fetch("/api/menu").then(r=>r.json());
  list.innerHTML="";
  m.forEach(x=>{
    list.innerHTML+=`
      <div class="card ${x.qty===0?'out':''}">
        <b>${x.name}</b> ‚Äì ${x.price}‚ÇÆ (“Æ–ª–¥: ${x.qty})
        <button onclick="del('${x.name}')">‚ùå</button>
      </div>`;
  });

  const s = await fetch("/api/admin-settlement").then(r=>r.json());
  settle.innerHTML="";
  Object.keys(s).forEach(k=>{
    settle.innerHTML+=`
      <tr>
        <td>${k}</td>
        <td>${s[k].qty}</td>
        <td>${s[k].sum}</td>
      </tr>`;
  });
}

async function del(name){
  await fetch("/api/menu/"+name,{method:"DELETE"});
  load();
}

load();
</script>
  <div id="print-kitchen" style="position:absolute; left:-9999px;"></div>
<div id="print-cash" style="position:absolute; left:-9999px;"></div>

</body>
</html>
