<!DOCTYPE html>
<html lang="mn">
<meta charset="UTF-8">
<title>Waiter</title>
<body>
<h2>WAITER</h2>

<select id="table">
<option value="">–®–∏—Ä—ç—ç</option>
<option>0</option><option>1</option><option>2</option>
<option>3</option><option>4</option><option>5</option>
<option>6</option><option>7</option><option>8</option><option>9</option>
<option>VIP-1</option><option>VIP-2</option><option>Carry</option>
</select>

<h3>üçΩ Menu</h3>
<div id="menu"></div>

<h3>üßæ –ó–∞—Ö–∏–∞–ª–≥–∞</h3>
<div id="cart"></div>
<button onclick="send()">–•—ç–≤–ª—ç—Ö</button>

<script>
let CART=[];

async function load(){
  const m=await fetch("/api/menu").then(r=>r.json());
  const d=await fetch("/api/drinks").then(r=>r.json());
  menu.innerHTML=[...m,...d].map(x=>
    `<button onclick='add("${x.name}",${x.price},"${x.cat}")'>
      ${x.name}
    </button>`
  ).join(" ");
}

function add(n,p,c){
  const x=CART.find(i=>i.name===n);
  x?x.qty++:CART.push({name:n,price:p,qty:1,cat:c});
  draw();
}

function draw(){
  cart.innerHTML=CART.map(i=>`${i.name} x${i.qty}`).join("<br>");
}

async function send(){
  const r=await fetch("/api/order",{method:"POST",headers:{'Content-Type':'application/json'},
  body:JSON.stringify({table:table.value,items:CART})});
  const d=await r.json();
  print(CART,table.value,d.bill);
  CART=[]; draw();
}

function print(items,table,bill){
  let t=0;
  let h=`<h3>–ö–ê–°–°</h3>–®–∏—Ä—ç—ç:${table}<br>–ë–∏–ª–ª:${bill}<hr>`;
  items.forEach(i=>{t+=i.price*i.qty;h+=`${i.name} x${i.qty}<br>`});
  h+=`<hr>–ù–ò–ô–¢:${t}`;
  const w=window.open("");w.document.write(h);w.print();w.close();

  let k=`<h3>–ì–ê–õ –¢–û–ì–û–û</h3>–®–∏—Ä—ç—ç:${table}<hr>`;
  items.filter(i=>i.cat==="–•–æ–æ–ª")
       .forEach(i=>k+=`${i.name} x${i.qty}<br>`);
  const w2=window.open("");w2.document.write(k);w2.print();w2.close();
}

load();
</script>
</body>
</html>
