<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>Saikhan POS ‚Äì Waiter</title>
<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:#2c7be5;color:#fff;padding:10px}
section{padding:10px}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.card{background:#fff;padding:8px;border-radius:6px;cursor:pointer;text-align:center}
.card.low{background:#ffcccc}
.active{background:#2c7be5;color:#fff}
.order-item{display:flex;justify-content:space-between;margin:5px 0}
button{padding:5px 10px}
</style>
</head>

<body>

<header>
<h2>WAITER</h2>
<div id="billInfo">–ë–∏–ª–ª: - | –®–∏—Ä—ç—ç: -</div>
</header>

<section>
<h3>ü™ë –®–∏—Ä—ç—ç —Å–æ–Ω–≥–æ—Ö</h3>
<div id="tables"></div>
</section>

<section>
<h3>üìã Menu (—Ö–æ–æ–ª)</h3>
<div id="menu" class="grid"></div>
</section>

<section>
<h3>ü•§ –£—Å / –£–Ω–¥–∞–∞ / –¶–∞–π</h3>
<div id="drinks" class="grid"></div>
</section>

<section>
<h3>üìù –ó–∞—Ö–∏–∞–ª–≥–∞</h3>
<div id="order"></div>
<h3>–ù–∏–π—Ç: <span id="total">0</span>‚ÇÆ</h3>
<button onclick="sendOrder()">–•—ç–≤–ª—ç—Ö / –ë–∞—Ç–ª–∞—Ö</button>
</section>

<section>
<h3>üì¶ –û—Ä–ª–æ–≥–æ (–£—Å / –£–Ω–¥–∞–∞ / –¶–∞–π)</h3>
<div id="stock"></div>
</section>

<script>
let menu=[], stock=[];
let currentTable=null;
let order=[];

/* ===== LOAD ===== */
async function load(){
  menu = await fetch("/api/menu").then(r=>r.json());
  stock = await fetch("/api/stock").then(r=>r.json());
  drawMenu();
  drawDrinks();
  drawStock();
  drawTables();
}
load();

/* ===== TABLES ===== */
function drawTables(){
  const t = document.getElementById("tables");
  t.innerHTML="";
  [...Array(10).keys()].forEach(i=>{
    const b=document.createElement("button");
    b.textContent="–®–∏—Ä—ç—ç "+i;
    b.onclick=()=>selectTable("–®–∏—Ä—ç—ç "+i);
    t.appendChild(b);
  });
  ["VIP 1","VIP 2","Carry"].forEach(n=>{
    const b=document.createElement("button");
    b.textContent=n;
    b.onclick=()=>selectTable(n);
    t.appendChild(b);
  });
}
function selectTable(t){
  currentTable=t;
  document.getElementById("billInfo").textContent="–®–∏—Ä—ç—ç: "+t;
}

/* ===== MENU ===== */
function drawMenu(){
  const d=document.getElementById("menu");
  d.innerHTML="";
  menu.filter(m=>m.cat==="–•–æ–æ–ª").forEach(m=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<b>${m.name}</b><br>${m.price}‚ÇÆ`;
    c.onclick=()=>addItem(m.name,m.price,false);
    d.appendChild(c);
  });
}

/* ===== DRINKS TO ORDER ===== */
function drawDrinks(){
  const d=document.getElementById("drinks");
  d.innerHTML="";
  stock.forEach(s=>{
    const c=document.createElement("div");
    c.className="card"+(s.qty<10?" low":"");
    c.innerHTML=`<b>${s.name}</b><br>“Æ–ª–¥: ${s.qty}`;
    c.onclick=()=>addItem(s.name,0,true);
    d.appendChild(c);
  });
}

/* ===== ORDER ===== */
function addItem(name,price,isStock){
  let i=order.find(x=>x.name===name);
  if(i) i.qty++;
  else order.push({name,price,qty:1,isStock});
  drawOrder();
}
function drawOrder(){
  const o=document.getElementById("order");
  o.innerHTML="";
  let total=0;
  order.forEach(i=>{
    total+=i.price*i.qty;
    const d=document.createElement("div");
    d.className="order-item";
    d.innerHTML=`
      ${i.name}
      <span>
        <button onclick="chg('${i.name}',-1)">‚ûñ</button>
        ${i.qty}
        <button onclick="chg('${i.name}',1)">‚ûï</button>
      </span>`;
    o.appendChild(d);
  });
  document.getElementById("total").textContent=total;
}
function chg(n,v){
  const i=order.find(x=>x.name===n);
  if(!i) return;
  i.qty+=v;
  if(i.qty<=0) order=order.filter(x=>x!==i);
  drawOrder();
}

/* ===== SEND ORDER ===== */
async function sendOrder(){
  if(!currentTable){ alert("–®–∏—Ä—ç—ç —Å–æ–Ω–≥–æ–Ω–æ —É—É"); return; }
  await fetch("/api/order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({table:currentTable,items:order})
  });
  order=[];
  drawOrder();
  alert("–ó–∞—Ö–∏–∞–ª–≥–∞ —Ö—ç–≤–ª—ç–≥–¥–ª—ç—ç");
}

/* ===== STOCK ORLOGO ===== */
function drawStock(){
  const d=document.getElementById("stock");
  d.innerHTML="";
  stock.forEach(s=>{
    const div=document.createElement("div");
    div.innerHTML=`
      ${s.name} (“Æ–ª–¥:${s.qty})
      <input type="number" id="q_${s.name}" style="width:60px">
      <button onclick="addStock('${s.name}','${s.cat}')">–ù—ç–º—ç—Ö</button>
    `;
    d.appendChild(div);
  });
}
async function addStock(name,cat){
  const q=document.getElementById("q_"+name).value;
  await fetch("/api/orlogo",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name,cat,qty:Number(q)})
  });
  load();
}
</script>

</body>
</html>
