<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>Saikhan POS ‚Äì Waiter</title>
<style>
body{font-family:Arial;margin:0;background:#f5f5f5}
header{background:#2c7be5;color:#fff;padding:12px;text-align:center}
h2{margin:0}
section{padding:10px}
button{padding:6px 10px;margin:5px;border:none;border-radius:4px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:6px;text-align:left}
</style>
</head>
<body>

<header>
<h2>WAITER</h2>
</header>

<section>
<h3>üìù –ù—ç–≥—Ç–≥—ç–ª —Ö—ç–≤–ª—ç—Ö</h3>
<button onclick="printSettlement()">–ù—ç–≥—Ç–≥—ç–ª —Ö—ç–≤–ª—ç—Ö</button>
<div id="settleDiv" style="display:none;">
  <table>
    <thead>
      <tr><th>–ù—ç—Ä</th><th>–¢–æ–æ</th><th>–ù–∏–π—Ç “Ø–Ω—ç</th></tr>
    </thead>
    <tbody id="settleBody"></tbody>
  </table>
</div>
</section>

<script>
async function printSettlement(){
  // API-—Å settlements –∞–≤–Ω–∞
  const res = await fetch("/api/settlements");
  const data = await res.json();

  const map={};
  // ”®–º–Ω”©—Ö –Ω—ç–≥—Ç–≥—ç–ª—ç—ç—Å —Ö–æ–π—à—Ö–∏ –±“Ø—Ö –∑–∞—Ö–∏–∞–ª–≥–∞
  data.forEach(s=>{
    s.orders.forEach(o=>{
      o.items.forEach(i=>{
        if(!map[i.name]) map[i.name]={qty:0,sum:0};
        map[i.name].qty+=i.qty;
        map[i.name].sum+=i.qty*i.price;
      });
    });
  });

  const tbody=document.getElementById("settleBody");
  tbody.innerHTML="";
  Object.keys(map).forEach(n=>{
    tbody.innerHTML+=`
      <tr>
        <td>${n}</td>
        <td>${map[n].qty}</td>
        <td>${map[n].sum}‚ÇÆ</td>
      </tr>
    `;
  });

  // –•–∞—Ä–∞–≥–¥–∞–∂ —Ö—ç–≤–ª—ç–≥–¥—ç—Ö
  document.getElementById("settleDiv").style.display="block";

  // –ü—Ä–∏–Ω—Ç–µ—Ä—ç—ç—Ä —Ö—ç–≤–ª—ç—Ö
  window.print();
}
</script>

</body>
</html>
