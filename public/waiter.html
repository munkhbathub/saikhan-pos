<!DOCTYPE html>
<html lang="mn">
<head>
<meta charset="UTF-8">
<title>Waiter</title>
<style>
body{
  font-family:Arial;
  margin:0;
  background:#f5f5f5
}

header{
  background:#2c7be5;
  color:#fff;
  padding:12px
}

/* MENU GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px
}

.card{
  background:#fff;
  padding:8px;
  border-radius:6px;
  text-align:center;
  cursor:pointer
}

.card.low{
  background:#ffcccc
}

/* ORDER LIST */
.order-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#fff;
  padding:8px;
  margin:6px 0;
  border-radius:6px;
}

.order-row button{
  padding:2px 6px;
  margin:0 2px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}

.order-row button:hover{
  opacity:0.8
}

/* TABLE BUTTONS */
button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer
}

button:active{
  transform:scale(0.97)
}
</style>
</head>
<body>

<header>
<h2>Saikhan POS ‚Äì WAITER</h2>
<div id="info">–®–∏—Ä—ç—ç: - | Bill: -</div>
</header>

<h3>ü™ë –®–∏—Ä—ç—ç</h3>
<div id="tables"></div>

<h3>üìã Menu</h3>
<div id="menu" class="grid"></div>

<h3>üìù –ó–∞—Ö–∏–∞–ª–≥–∞</h3>
<div id="order"></div>
<h3>–ù–∏–π—Ç: <span id="total">0</span>‚ÇÆ</h3>
<button onclick="send()">üñ®Ô∏è –•—ç–≤–ª—ç—Ö (2 —Ö—É–≤—å)</button>

<h3>üìä –ù—ç–≥—Ç–≥—ç–ª —Ö—ç–≤–ª—ç—Ö</h3>
<button onclick="settle()">–ù—ç–≥—Ç–≥—ç–ª —Ö—ç–≤–ª—ç—Ö</button>

<script>
let menu=[],stock=[],order=[],table=null,bill=0;

async function load(){
 menu=await fetch("/api/menu").then(r=>r.json());
 stock=await fetch("/api/stock").then(r=>r.json());
 drawTables(); drawMenu();
}
load();

function drawTables(){
 const tables = document.getElementById("tables");
 tables.innerHTML="";
 ["0","1","2","3","4","5","6","7","8","9","VIP –ù–∞–∞–¥","VIP –¶–∞–∞–¥","–ê–≤—á —è–≤–∞—Ö"]
 .forEach(t=>{
  const b=document.createElement("button");
  b.textContent=t;
  b.onclick=()=>{table=t;info.innerText=`–®–∏—Ä—ç—ç: ${t} | Bill: ${bill+1}`};
  tables.appendChild(b);
 });
}

function drawMenu(){
 menuDiv=document.getElementById("menu");
 menuDiv.innerHTML="";
 menu.forEach(m=>{
  const s=stock.find(x=>x.name===m.name);
  const q=s?s.qty:"-";
  const d=document.createElement("div");
  d.className="card"+(q!=="-"&&q<10?" low":"");
  d.innerHTML=`<b>${m.name}</b><br>${m.price}‚ÇÆ<br>“Æ–ª–¥:${q}`;
  d.onclick=()=>add(m);
  menuDiv.appendChild(d);
 });
}

function add(m){
 if(!table){alert("–®–∏—Ä—ç—ç —Å–æ–Ω–≥–æ–Ω–æ —É—É");return;}
 const i=order.find(x=>x.name===m.name);
 i?i.qty++:order.push({name:m.name,price:m.price,qty:1});
 drawOrder();
}

function drawOrder(){
  const d=document.getElementById("order");
  d.innerHTML="";
  let t=0;

  order.forEach((i,idx)=>{
    const sum=i.price*i.qty;
    t+=sum;

    const r=document.createElement("div");
    r.className="order-row";
    r.innerHTML=`
      <div>
        <b>${i.name}</b><br>
        ${i.price}‚ÇÆ √ó ${i.qty} = <b>${sum}‚ÇÆ</b>
      </div>
      <div>
        <button onclick="chg(${idx},-1)">‚ûñ</button>
        <button onclick="chg(${idx},1)">‚ûï</button>
        <button onclick="delItem(${idx})">‚ùå</button>
      </div>
    `;
    d.appendChild(r);
  });

  document.getElementById("total").textContent=t;
}
function chg(i,delta){
  order[i].qty+=delta;
  if(order[i].qty<=0) order.splice(i,1);
  drawOrder();
}

function delItem(i){
  order.splice(i,1);
  drawOrder();
}

async function send(){
 if(!table||order.length==0) return;
 await fetch("/api/order",{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({table,items:order,total:+total.innerText})});
 order=[]; table=null; load();
 alert("–•—ç–≤–ª—ç–≥–¥–ª—ç—ç");
}

async function settle(){
 await fetch("/api/settlement",{method:"POST"});
 alert("–ù—ç–≥—Ç–≥—ç–ª —Ö—ç–≤–ª—ç–≥–¥–ª—ç—ç");
}
</script>
</body>
</html>
